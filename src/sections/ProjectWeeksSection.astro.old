---
//import fs from 'fs';
//import path from 'path';
import { Image, Picture } from '@astrojs/image/components';

import '@splidejs/splide/css/core';

const section = Astro.props;

const activeItem = section.data.items[0];
//const galleryImages = fs.readdirSync(path.join(import.meta.env.BASE_PATH, 'public', 'project-weeks', activeItem.country.code, 'gallery'));
---

<script hoist>
	import Splide from '@splidejs/splide';
	
	document.addEventListener("DOMContentLoaded", () => {
			const gallerySlider = new Splide('.section__project-weeks .splide.slider__main', {
				type      : 'fade',
    		rewind    : true,
    		pagination: false,
    		arrows    : false,
				autoHeight : true
  		});
			
			const galleryThumbnails = new Splide('.section__project-weeks .splide.slider__thumbnails', {
				fixedWidth  : 100,
				fixedHeight : 60,
				gap         : 10,
				rewind      : true,
				pagination  : false,
				arrows    : false,
				isNavigation: true,
			});
			
			gallerySlider.sync(galleryThumbnails);
			
			gallerySlider.mount();
			galleryThumbnails.mount();
	});
</script>

<div class="flex flex-col gap-4">
	<!-- Tabs -->
	<div class="flex flex-col lg:flex-row gap-4">
		{
			section.data.items.map(({ country }) => (
				<button class="flex items-center gap-3 p-2 shadow-md bg-white flex-1 rounded-md">
					<div class="w-8 aspect-square">
						<img
							class="w-full h-full object-contain object-center"
							src={`/icons/ico-country-logo-${country.code}.svg`}
							alt={`country-logo-${country.code}`}
						/>
					</div>
					<span class="text-blue-700 font-semibold text-xl">
						{country.name}
					</span>
				</button>
			))
		}
	</div>

	<!-- Project Week - View -->
	<div class="rounded-md overflow-hidden">
		<!-- Project Week - Header -->
		<hgroup
			class="flex flex-row gap-4 text-blue-500 justify-between py-8 px-8 bg-blue-50 bg-opacity-50"
		>
			<h1 class="text-4xl font-semibold">{activeItem.country.name}</h1>
			<div class="flex flex-row gap-4 items-center">
				{
					Object.entries(activeItem.dates).map(([type, date]: [string, string]) => (
						<div class="text-lg">
							<span class="text-light">
								{new Date(
									date.split("/").reverse().join("-")
								).toLocaleDateString("en-GB", { weekday: "long" })}
							</span>
							<strong class="text-semibold">{date}</strong>
						</div>
					))
				}
			</div>
		</hgroup>

		<!-- Project Week - Content -->
		<div class="bg-white p-8 grid grid-cols-5 gap-8">
			<!-- Project Week - Activities -->
			<div class="col-span-2">
				<h2 class="text-2xl text-blue-500 font-semibold mb-6">Activities</h2>
				<ul class="flex flex-col list-none">
					{
						activeItem.activities.map(({ name, file, type }) => (
							<li class="pb-2 mb-2 gap-4 last:mb-0 border-b last:border-b-0 flex items-center justify-between">
								<div class="flex items-center gap-3">
									<img src={`/icons/ico-file-type-${type}.svg`} alt="" />
									<span class="text-blue-500">{name}</span>
								</div>
								<div class="flex items-center gap-2">
									{/*['pdf'].includes(type) && <a class="py-1.5 px-4 rounded-md bg-blue-400 hover:bg-blue-500 text-white" href={`/project-weeks/${activeItem.country.code}/activities/${file}`} target="_blank">View</a>*/}
									<a class="py-1.5 px-4 rounded-md bg-blue-400 hover:bg-blue-500 text-white" href={`/project-weeks/${activeItem.country.code}/activities/${file}`} download>Download</a>
								</div>
							</li>
						))
					}
				</ul>
			</div>
			<!-- Project Week - Gallery -->
			<div class="col-span-3">
				<h2 class="text-2xl text-blue-500 font-semibold mb-6">Gallery</h2>
				
				<div class="flex flex-col gap-4">
					<div class="splide slider__main">
						<div class="splide__track">
							<ul class="splide__list">
								{activeItem.gallery.map((image) => (
									<li class="splide__slide rounded-md overflow-hidden">
										<Picture
											widths={[320, 640, 720]}
											sizes="(max-width: 800px) 100vw, 800px"
											src={import(`../assets/project-weeks/${activeItem.country.code}/gallery/${image}.jpg`)}
											class:list={['bg-gray-100']}
											alt=""
										/>
									</li>
								))}
							</ul>
						</div>
					</div>
					
					<div class="splide slider__thumbnails">
						<div class="splide__track">
							<ul class="splide__list">
								{activeItem.gallery.map((image) => (
									<li class="splide__slide rounded-md overflow-hidden">
										<Image
											class="object-cover h-full"
											sizes="(max-width: 800px) 100vw, 800px"
											src={import(`../assets/project-weeks/${activeItem.country.code}/gallery/${image}.jpg`)}
											class:list={['bg-gray-100']}
											alt=""
										/>
									</li>
								))}
							</ul>
						</div>
				</div>
					
				</div>
			</div>
		</div>
	</div>
</div>
